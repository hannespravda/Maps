<!DOCTYPE html>
<html lang="en">
<head>
    <title>MyMap</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Leaflet -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

    <!-- location-->
    <link rel="stylesheet" href="leaflet-locatecontrol-gh-pages\dist\L.Control.Locate.mapbox.min.css"/>
    <script src="leaflet-locatecontrol-gh-pages\dist\L.Control.Locate.min.js"></script>

    <!-- cluster-->
    <link rel="stylesheet" href="Leaflet.markercluster-1.4.1\dist\MarkerCluster.css"/>
    <link rel="stylesheet" href="Leaflet.markercluster-1.4.1\dist\MarkerCluster.Default.css"/>
    <script src="Leaflet.markercluster-1.4.1\dist\leaflet.markercluster-src.js"></script>
    <script src="Leaflet.markercluster-1.4.1\dist\leaflet.markercluster.js"></script>
    
    <!-- search master -->
    <link rel="stylesheet" href="leaflet-search-master\dist\leaflet-search.src.css"/>
    <script src="leaflet-search-master\dist\leaflet-search.src.js"></script>

    <!-- style -->
    <style>
        #map {position: absolute; top: 0; bottom: 0; left: 0; right: 0}

        #filter-toggle {
            position: absolute;
            top: 10px; /* Adjust the top position as needed */
            left: 97.3%; /* Adjust the left position as needed */
            transform: translateX(-50%);
            z-index: 1000;
            background-color: white;
            color: rgb(126, 121, 121);
            border: 2px solid #ccc;
            border-radius: 5px;
            font-family: Helvetica, Arial, sans-serif;
            font-size: 12px;
            padding: 5px; /* Add padding to create space around the text */
            text-align: center; /* Center the text horizontally */
            width: 35px;
            cursor: pointer;
            user-select: none;
        }
        #filter {
            position: absolute;
            top: 10px; /* Adjust the top position as needed */
            left: 87%; /* Adjust the left position as needed */
            transform: translateX(-50%);
            z-index: 1000;
            background-color: white;
            border: 2px solid #ccc;
            border-radius: 10px;
            font-family: Helvetica, Arial, sans-serif;
            font-size: 12px;
            padding: 5px; /* Add padding to create space around the text */
            text-align: center; /* Center the text horizontally */
            width: 200px;
            user-select: none;
          }
        .filter-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        .filter-input {
            width: 50px;
            text-align: center;
            color: black;
        }
        .filter-row input:first-child {
            width: 50px;
            text-align: center;
            color: black; /* Grey text */
        }
        .filter-input::placeholder {
            color: grey; /* Placeholder text color */
            font-size: 12px;
        }
        .separator-line {
            border-top: 1px solid #ccc;
            margin-top: 10px;
            margin-bottom: 10px;
        }
        .height-label {
            text-align: left;
            width: 50px;
        }
        .elevation-label {
            text-align: left;
            width: 50px;
        }
        .length-label {
            text-align: left;
            width: 50px;
        }
        .slope-label {
            text-align: left;
            width: 50px;
        }
        .min-height {
            margin-left: 10px;
        }
        .min-elevation {
            margin-left: 10px;
        }
        .min-length {
            margin-left: 10px;
        }
        .min-slope {
            margin-left: 10px;
        }
        .leaflet-top.leaflet-right .leaflet-control {
            top: 29px; /* Adjust the top position as needed */
            user-select: none;
        }
        .filter-row button {
            /* Add styling to the buttons as needed */
            padding: 0px 7px; /* Adjust padding to desired size */
            background-color: white; /* Example background color */
            color: lightblue; /* Text color */
            font-family: Helvetica, Arial, sans-serif;
            font-size: 12px;
            border: none; /* Remove border */
            cursor: pointer;
            user-select: none;
        }
        #resetFilter {
            width: 150px;
            text-align: right;
            color: rgb(179, 108, 108); /* Text color */
            user-select: none;
        }
        .filter-input[type="number"]::-webkit-inner-spin-button,
        .filter-input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        
        #table-toggle {
            position: absolute;
            top: 170px; /* Adjust the top position as needed */
            left: 2.1%; /* Adjust the left position as needed */
            transform: translateX(-50%);
            z-index: 1000;
            background-color: white;
            color: rgb(126, 121, 121);
            border: 2px solid #ccc;
            border-radius: 5px;
            font-family: Helvetica, Arial, sans-serif;
            font-size: 12px;
            padding: 5px; /* Add padding to create space around the text */
            text-align: center; /* Center the text horizontally */
            width: 20px;
            cursor: pointer;
            user-select: none;
        }
        #table-container {
            position: absolute;
            top: 170px;
            left: 28%;
            transform: translate(-50%);
            z-index: 1000;
            background-color: white;
            color: rgb(126, 121, 121);
            border: 2px solid #ccc;
            border-radius: 10px;
            font-family: Helvetica, Arial, sans-serif;
            font-size: 12px;
            text-align: left;
            max-width: 600px;
            max-height: 397px; /* Set a fixed height */
            overflow: auto; /* Hide overflow to prevent the table from extending beyond the fixed height */
            display: none;
            user-select: none;
        }
        #data-table th,
        #data-table td {
            padding: 8px; /* Adjust the padding to increase/decrease space between columns */
        }
        #data-table th:nth-child(1),
        #data-table td:nth-child(1) {
            width: 10px; /* Adjust the width for the first column */
        }
        #data-table th:nth-child(2),
        #data-table td:nth-child(2) {
            width: 300px; /* Adjust the width for the second column */
        }
        #data-table th:nth-child(3),
        #data-table td:nth-child(3) {
            width: 50px; /* Adjust the width for the third column */
        }
        #data-table th:nth-child(4),
        #data-table td:nth-child(4) {
            width: 80px; /* Adjust the width for the third column */
        }
        #data-table th:nth-child(5),
        #data-table td:nth-child(5) {
            width: 80px; /* Adjust the width for the third column */
        }
        .sort-container {
            display: flex;
            align-items: center;
            padding: 10px; /* Add padding to create space around the text */
        }
        .sort-container label {
            margin-right: 10px; /* Adjust margin as needed to separate label from the select box */
        }
        #toggle-sort-order {
            margin-left: 5px; /* Adjust the value as needed */
            background-color: white;
            border: 0px solid #ccc;
            font-family: Helvetica, Arial, sans-serif;
            font-size: 12px;
            text-align: left;
            cursor: pointer;
            color: lightblue;
            user-select: none;
        }
        #reset-checkboxes {
            margin-left: -1px; /* Adjust the value as needed */
            background-color: white;
            color: rgb(179, 108, 108);
            border: 0px solid #ccc;
            font-family: Helvetica, Arial, sans-serif;
            font-size: 12px;
            text-align: left;
            cursor: pointer;
            user-select: none;
        }
        .additional-info {
            background-color: #f2f2f2; /* Grey background color */
            padding: 1px; /* Add padding for spacing */
            margin-left: 35px; /* Adjust as needed for spacing from the left margin */
            margin-top: -15px;
        }
        .hidden {
            display: none; /* Hide the additional info by default */
        }
        .show-more-button {
            background-color: white; /* Set the background color */
            color: lightblue; /* Set the text color */
            border-radius: 0px; /* Add rounded corners */
            cursor: pointer; /* Set cursor to pointer for interaction */
            user-select: none;
        }
    </style>

    <!--------------------- add geoJSON files renamed to .js files here -------------------------------------->
    <!-------------------------------------------------------------------------------------------------------->
    <script src = "passi.js"></script>
    <script src = "Tracks/Valcava.js"></script>
    <script src = "Tracks/Iseran.js"></script>
    <script src = "Tracks/Zambla.js"></script>
    <script src = "Tracks/Selvino.js"></script>
    <script src = "Tracks/Ganda.js"></script>
    <script src = "Tracks/Brianza.js"></script>
    <script src = "Tracks/Ghisallo.js"></script>
    <script src = "Tracks/Sormano.js"></script>
    <script src = "Tracks/Valbrona.js"></script>
    <script src = "Tracks/Madonnina.js"></script>
    <script src = "Tracks/Primo.js"></script>
    <script src = "Tracks/Montevecchia.js"></script>
    <script src = "Tracks/Miragolo.js"></script>
    <script src = "Tracks/Salmezza.js"></script>
    <script src = "Tracks/Nespello.js"></script>
    <script src = "Tracks/Culmine.js"></script>
    <script src = "Tracks/Agueglio.js"></script>
    <script src = "Tracks/Narro.js"></script>
    <script src = "Tracks/Valvarrone.js"></script>
    <script src = "Tracks/Marco.js"></script>
    <script src = "Tracks/Berbenno.js"></script>
    <script src = "Tracks/Fuipiano.js"></script>
    <script src = "Tracks/Bura.js"></script>
    <script src = "Tracks/Antonio.js"></script>
    <script src = "Tracks/Balisio.js"></script>
    <script src = "Tracks/Splugen.js"></script>
    <script src = "Tracks/Bernardino.js"></script>
    <script src = "Tracks/Maloja.js"></script>
    <script src = "Tracks/Julier.js"></script>
    <script src = "Tracks/Albula.js"></script>
    <script src = "Tracks/Bernina.js"></script>
    <script src = "Tracks/Vivione.js"></script>
    <script src = "Tracks/Aprica.js"></script>
    <script src = "Tracks/Crocedomini.js"></script>
    <script src = "Tracks/Eira.js"></script>
    <script src = "Tracks/Forcora.js"></script>
    <script src = "Tracks/Foscagno.js"></script>
    <script src = "Tracks/Furka.js"></script>
    <script src = "Tracks/Gavia.js"></script>
    <script src = "Tracks/Gottardo.js"></script>
    <script src = "Tracks/GranBernard.js"></script>
    <script src = "Tracks/Grimsel.js"></script>
    <script src = "Tracks/Guspessa.js"></script>
    <script src = "Tracks/Livigno.js"></script>
    <script src = "Tracks/Lukmanier.js"></script>
    <script src = "Tracks/Maniva.js"></script>
    <script src = "Tracks/Marzio.js"></script>
    <script src = "Tracks/Montecampione.js"></script>
    <script src = "Tracks/Mortirolo.js"></script>
    <script src = "Tracks/Neggia.js"></script>
    <script src = "Tracks/Nufenen.js"></script>
    <script src = "Tracks/Oberalp.js"></script>
    <script src = "Tracks/Ofen.js"></script>
    <script src = "Tracks/Presolana.js"></script>
    <script src = "Tracks/Simplon.js"></script>
    <script src = "Tracks/Stelvio.js"></script>
    <script src = "Tracks/Susten.js"></script>
    <script src = "Tracks/Tedesco.js"></script>
    <script src = "Tracks/Tonale.js"></script>
    <script src = "Tracks/Trivigno.js"></script>
    <script src = "Tracks/Umbrail.js"></script>
    <script src = "Tracks/Zeno.js"></script>
    <!-------------------------------------------------------------------------------------------------------->
    <!-------------------------------------------------------------------------------------------------------->
</head>
<body>
    <div id = "map"></div>  

    <div id="filter-toggle">Filter</div>
    <div id="filter" style="display: none;">
        <div id="checkbox-container">
            <div id="filter-bar">
                <label for="passCheckbox">Pass</label>
                <input type="checkbox" id="passCheckbox">
                <label for="climbCheckbox">Climb</label>
                <input type="checkbox" id="climbCheckbox">
                <label for="sackgasseCheckbox">Sackgasse</label>
                <input type="checkbox" id="sackgasseCheckbox">
            </div>
        </div>
        <hr class="separator-line">
        <div class="filter-row">
            <label class="height-label">Height:</label>
            <input type="number" id="minHeight" class="min-height filter-input" step="10" placeholder="min m">
            <input type="number" id="maxHeight" class="max-height filter-input" step="10" placeholder="max m">
        </div>
        <div class="filter-row">
            <label class="elevation-label">Elevation:</label>
            <input type="number" id="minElevation" step="10" class="min-elevation filter-input" placeholder="min hm">
            <input type="number" id="maxElevation" step="10" class="max-elevation filter-input" placeholder="max hm">
        </div>
        <div class="filter-row">
            <label class="length-label">Length:</label>
            <input type="number" id="minLength" step="10" class="min-length filter-input" placeholder="min km">
            <input type="number" id="maxLength" step="10" class="max-length filter-input" placeholder="max km">
        </div>
        <div class="filter-row">
            <label class="slope-label">Slope:</label>
            <input type="number" id="minSlope" step="10" class="min-slope filter-input" placeholder="min %">
            <input type="number" id="maxSlope" step="10" class="max-slope filter-input" placeholder="max %">
        </div>
        <div class="filter-row">
            <button id="resetFilter">Reset</button>
            <button id="applyFilter">Apply</button>
        </div>
    </div>

    <div id="table-toggle">List</div>
    <div id="table-container" style="display: none;">
        <div class="sort-container">
            <label for="sort-options">Sort by:</label>
            <select id="sort-options">
                <option value="empty"> </option>
                <option value="alphabetical">Alphabetical</option>
                <option value="country">Country</option>
                <option value="height">Height</option>
                <option value="length">Length</option>
                <option value="elevation">Elevation</option>
                <option value="slope">Slope</option>
            </select>
            <button id="toggle-sort-order" onclick="toggleSortOrder()">↑↓</button>
            <button id="reset-checkboxes" onclick="resetCheckboxes()">clear</button>
        </div>
        <table id="data-table">
            <thead>
                <tr>
                    <th></th>
                    <th>Name</th>
                    <th>Country</th>
                    <th>Height</th>
                    <th>Length</th>
                    <th>Elevation</th>
                    <th>Slope</th>
                </tr>
            </thead>
            <tbody id="data-body"></tbody>
        </table>
    </div>

    <script>
        //center coordinates at start
        var map = L.map('map', {
            minZoom: 2,
        }).setView([45.464664, 9.188540],13);

        //table
        var tableToggle = document.getElementById("table-toggle");
        var table = document.getElementById("table-container");
        const dataBody = document.getElementById("data-body");
        const sortDropdown = document.getElementById("sort-options");
        tableToggle.addEventListener("click", function() {
            if (table.style.display === "none" || table.style.display === "") {
                table.style.display = "block";
            } else {
                table.style.display = "none";
            }
        });
        function toggleSortOrder() {
            const table = document.getElementById("data-table");
            const tbody = table.querySelector("tbody");
            const rows = Array.from(tbody.querySelectorAll("tr"));
            rows.reverse();
            while (tbody.firstChild) {
                tbody.removeChild(tbody.firstChild);
            }
            rows.forEach((row) => tbody.appendChild(row));
        }
        function sortAlphabetically(columnIndex) {
            const table = document.getElementById("data-table");
            const tbody = table.querySelector("tbody");
            const rows = Array.from(tbody.querySelectorAll("tr"));
            rows.sort((a, b) => {
                const valueA = a.cells[columnIndex].textContent.trim();
                const valueB = b.cells[columnIndex].textContent.trim();
                return valueA.localeCompare(valueB);
            });
            while (tbody.firstChild) {
                tbody.removeChild(tbody.firstChild);
            }
            rows.forEach((row) => tbody.appendChild(row));
        }
        function sortTableCountry() {
            const table = document.getElementById("data-table");
            const tbody = table.querySelector("tbody");
            const rows = Array.from(tbody.querySelectorAll("tr"));
            rows.sort((a, b) => {
                const countryA = a.cells[2].textContent.trim();
                const countryB = b.cells[2].textContent.trim();
                const nameA = a.cells[1].textContent.trim();
                const nameB = b.cells[1].textContent.trim();
                const countryComparison = countryA.localeCompare(countryB);
                if (countryComparison === 0) {
                    return nameA.localeCompare(nameB);
                }
                return countryComparison;
            });
            while (tbody.firstChild) {
                tbody.removeChild(tbody.firstChild);
            }
            rows.forEach((row) => tbody.appendChild(row));
        }
        function sortNumeric(columnIndex) {
            return function(a, b) {
                const valueA = parseFloat(a.cells[columnIndex].textContent.trim());
                const valueB = parseFloat(b.cells[columnIndex].textContent.trim());
                return valueB - valueA;
            };
        }
        function sortRandom() {
            const table = document.getElementById("data-table");
            const tbody = table.querySelector("tbody");
            const rows = Array.from(tbody.querySelectorAll("tr"));
            rows.sort(() => Math.random() - 0.5);
            while (tbody.firstChild) {
                tbody.removeChild(tbody.firstChild);
            }
            rows.forEach((row) => tbody.appendChild(row));
        }
        sortDropdown.addEventListener("change", function() {
            if (sortDropdown.value === "alphabetical") {
                sortAlphabetically(1);
            } else if (sortDropdown.value === "country") {
                sortTableCountry();
            } else if (sortDropdown.value === "height") {
                const rows = Array.from(dataBody.querySelectorAll("tr"));
                rows.sort(sortNumeric(3));
                rows.forEach((row) => dataBody.appendChild(row));
            } else if (sortDropdown.value === "length") {
                const rows = Array.from(dataBody.querySelectorAll("tr"));
                rows.sort(sortNumeric(4));
                rows.forEach((row) => dataBody.appendChild(row));
            } else if (sortDropdown.value === "elevation") {
                const rows = Array.from(dataBody.querySelectorAll("tr"));
                rows.sort(sortNumeric(5));
                rows.forEach((row) => dataBody.appendChild(row));
            } else if (sortDropdown.value === "slope") {
                const rows = Array.from(dataBody.querySelectorAll("tr"));
                rows.sort(sortNumeric(6));
                rows.forEach((row) => dataBody.appendChild(row));
            } else if (sortDropdown.value === "empty") {
                sortRandom();
            }
        });

        function createRow(idd, name, country, height, length, elevation, slope, additionalInfoArray) {
            const tableRow = document.createElement("tr");

            // Create a checkbox cell
            const checkboxCell = document.createElement("td");
            const checkbox = document.createElement("input");
            checkbox.type = "checkbox";
            checkbox.className = "checkbox99";
            checkbox.addEventListener("click", function () {
                checkboxCallback(idd, checkbox.checked);
            });
            checkboxCell.appendChild(checkbox);
            tableRow.appendChild(checkboxCell);
        
            const nameCell = document.createElement("td");
            nameCell.textContent = name;
        
            const showMoreButton = document.createElement("div");
            showMoreButton.textContent = "show more";
            showMoreButton.className = "show-more-button"; // Add the class to the div
            showMoreButton.onclick = function () {
                toggleAdditionalInfo(nameCell, additionalInfoArray);
            };
        
            nameCell.appendChild(showMoreButton);
            tableRow.appendChild(nameCell);
        
            const countryCell = document.createElement("td");
            countryCell.textContent = country;
            tableRow.appendChild(countryCell);
        
            const heightCell = document.createElement("td");
            heightCell.textContent = height + ' m';
            tableRow.appendChild(heightCell);
        
            const lengthCell = document.createElement("td");
            lengthCell.textContent = length + ' km';
            tableRow.appendChild(lengthCell);
        
            const elevationCell = document.createElement("td");
            elevationCell.textContent = elevation + ' hm';
            tableRow.appendChild(elevationCell);
        
            const slopeCell = document.createElement("td");
            slopeCell.textContent = slope + ' %';
            tableRow.appendChild(slopeCell);
        
            return tableRow;
        }

        function resetCheckboxes() {
            const checkboxes = document.querySelectorAll(".checkbox99");
            checkboxes.forEach(function (checkbox) {
                checkbox.checked = false;
            });
        };
        
        function toggleAdditionalInfo(container, additionalInfoArray) {
            const row = container.closest("tr");
            const newRow = row.cloneNode();
            newRow.classList.add('additional-info-row');
            const newCell = document.createElement("td");
            newCell.colSpan = row.cells.length;
            const newInfoContainer = document.createElement("div");
            newInfoContainer.className = "additional-info";
            additionalInfoArray.forEach(info => {
                const infoParagraph = document.createElement("p");
                infoParagraph.textContent = info;
                newInfoContainer.appendChild(infoParagraph);
            });
            newCell.appendChild(newInfoContainer);
            newRow.appendChild(newCell);
            if (container.querySelector(".show-more-button").textContent === "show more") {
                row.parentNode.insertBefore(newRow, row.nextSibling);
                container.querySelector(".show-more-button").textContent = "show less"
            } else if (container.querySelector(".show-more-button").textContent === "show less") {
                const addedRow = row.parentNode.querySelector('.additional-info-row');
                if (addedRow) {
                    row.parentNode.removeChild(addedRow);
                }
                container.querySelector(".show-more-button").textContent = "show more";
            }
        }

        function resetCheckboxes() {
            const checkboxes = document.querySelectorAll(".checkbox99");
            checkboxes.forEach(function (checkbox) {
                if (checkbox.checked){
                    checkbox.click();
                }
            });
        };

        

        //filter
        var filterToggle = document.getElementById("filter-toggle");
        var filter = document.getElementById("filter");
        var applyFilterButton = document.getElementById("applyFilter");
        var resetFilterButton = document.getElementById("resetFilter");
        var applyFilter = false;
        var FilterArray = [];

        applyFilterButton.addEventListener("click", function() {
            applyFilter = true;
            filterToggle.style.color = "lightblue";
            var minHeight = document.getElementById("minHeight").value;
            var maxHeight = document.getElementById("maxHeight").value;
            var minElevation = document.getElementById("minElevation").value;
            var maxElevation = document.getElementById("maxElevation").value;
            var minLength = document.getElementById("minLength").value;
            var maxLength = document.getElementById("maxLength").value;
            var minSlope = document.getElementById("minSlope").value;
            var maxSlope = document.getElementById("maxSlope").value;
            var passCheckbox = document.getElementById("passCheckbox").checked;
            var climbCheckbox = document.getElementById("climbCheckbox").checked;
            var sackgasseCheckbox = document.getElementById("sackgasseCheckbox").checked;
            FilterArray[0] = passCheckbox;
            FilterArray[1] = climbCheckbox;
            FilterArray[2] = sackgasseCheckbox;
            if (!minHeight){
                FilterArray[3] = 0; 
            } else {
                FilterArray[3] = parseFloat(minHeight);
            }
            if (!maxHeight){
                FilterArray[4] = 10000; 
            } else {
                FilterArray[4] = parseFloat(maxHeight);
            }
            if (!minElevation){
                FilterArray[5] = 0; 
            } else {
                FilterArray[5] = parseFloat(minElevation);
            }
            if (!maxElevation){
                FilterArray[6] = 10000; 
            } else {
                FilterArray[6] = parseFloat(maxElevation);
            }
            if (!minLength){
                FilterArray[7] = 0; 
            } else {
                FilterArray[7] = parseFloat(minLength);
            }
            if (!maxLength){
                FilterArray[8] = 10000; 
            } else {
                FilterArray[8] = parseFloat(maxLength);
            }
            if (!minSlope){
                FilterArray[9] = 0; 
            } else {
                FilterArray[9] = parseFloat(minSlope);
            }
            if (!maxSlope){
                FilterArray[10] = 10000; 
            } else {
                FilterArray[10] = parseFloat(maxSlope);
            }
            filter.style.display = "none";
        });

        resetFilterButton.addEventListener("click", function() {
            applyFilter = false;
            filterToggle.style.color = "grey";
            document.getElementById('minHeight').value = '';
            document.getElementById('maxHeight').value = '';
            document.getElementById('minElevation').value = '';
            document.getElementById('maxElevation').value = '';
            document.getElementById('minLength').value = '';
            document.getElementById('maxLength').value = '';
            document.getElementById('minSlope').value = '';
            document.getElementById('maxSlope').value = '';
            document.getElementById('passCheckbox').checked = false;
            document.getElementById('climbCheckbox').checked = false;
            document.getElementById('sackgasseCheckbox').checked = false;
            FilterArray[0] = false;
            FilterArray[1] = false;
            FilterArray[2] = false;
            FilterArray[3] = 0;
            FilterArray[4] = 10000;
            FilterArray[5] = 0;
            FilterArray[6] = 10000;
            FilterArray[7] = 0;
            FilterArray[8] = 10000;
            FilterArray[9] = 0;
            FilterArray[10] = 10000;
            filter.style.display = "none";
        });

        filterToggle.addEventListener("click", function() {
            if (filter.style.display === "none" || filter.style.display === "") {
                filter.style.display = "block";
            } else {
                filter.style.display = "none";
            }
        });
        resetFilterButton.click();

        //scale
        L.control.scale({
            metric: true,
            imperial: false,
            maxwidth: 100,
            position: 'bottomleft'
        }).addTo(map);

        //location
        L.control.locate().addTo(map);

        //map at start
        var osm = L.tileLayer('https://api.maptiler.com/maps/basic-v2/{z}/{x}/{y}.png?key=5oOhPnaZPwb4EiDFpWyW', {
            attribution: '<a href="https://www.maptiler.com/copyright/" target="_blank">&copy; MapTiler</a> <a href="https://www.openstreetmap.org/copyright" target="_blank">&copy; OpenStreetMap contributors</a>'
        }).addTo(map);
        //add other maps
        var satellite = L.tileLayer('https://api.maptiler.com/maps/satellite/{z}/{x}/{y}.jpg?key=5oOhPnaZPwb4EiDFpWyW', {
            attribution: '<a href="https://www.maptiler.com/copyright/" target="_blank">&copy; MapTiler</a> <a href="https://www.openstreetmap.org/copyright" target="_blank">&copy; OpenStreetMap contributors</a>'
        });
        var topo = L.tileLayer('https://api.maptiler.com/maps/topo-v2/{z}/{x}/{y}.png?key=5oOhPnaZPwb4EiDFpWyW', {
            attribution: '<a href="https://www.maptiler.com/copyright/" target="_blank">&copy; MapTiler</a> <a href="https://www.openstreetmap.org/copyright" target="_blank">&copy; OpenStreetMap contributors</a>'
        });

        //variables
        var geoJSONArray = [];
        var geoJSONs = [];
        var marks = [];
        var markerTable = [];
        var trackTable = [];
        var selected = [];
        var id;
        var markerStates = [];

        //custom icons
        var yellowIcon = L.icon({
            iconUrl: 'Images/gelb.png',
            iconSize: [16, 16], // Set the size of the icon
            iconAnchor: [8, 16],
            popupAnchor:  [0, -16]
        });
        var redIcon = L.icon({
            iconUrl: 'Images/red.png',
            iconSize: [16, 16], // Set the size of the icon
            iconAnchor: [8, 16], 
            popupAnchor:  [0, -16]
        });
        var blueIcon = L.icon({
            iconUrl: 'Images/blau.png',
            iconSize: [16, 16], // Set the size of the icon
            iconAnchor: [8, 16], 
            popupAnchor:  [0, -16]
        });
        var searchIcon = L.icon({
            iconUrl: 'Images/Empty.png',
            iconSize: [0, 0], // Set the size of the icon
            iconAnchor: [0, 0], 
            popupAnchor:  [0, 0]
        });
        
        //marker passes
        var marker = L.geoJSON(passi, {
            pointToLayer: function (feature, latlng) {
                // Create the marker with the custom icon
                if (feature.properties.category == 'Pass'){
                    return L.marker(latlng, {icon: blueIcon}).bindTooltip(feature.properties.name + ' (' + feature.properties.height + ' m)')
                } else if (feature.properties.category == 'Climb'){
                    return L.marker(latlng, {icon: yellowIcon}).bindTooltip(feature.properties.name + ' (' + feature.properties.height + ' m)')
                } else if (feature.properties.category == 'Sackgasse'){
                    return L.marker(latlng, {icon: redIcon}).bindTooltip(feature.properties.name + ' (' + feature.properties.height + ' m)')
                }
            },
            onEachFeature: function(feature, layer){
                var popupContent = "<div><input type='checkbox' id='MarkerCheckbox' /> Show routes </div>";
                layer.bindPopup('<p style="line-height: 1; margin-bottom: 5px;"><a href="' + feature.properties.link + '" target="_blank">' + feature.properties.name + '</a></div><div style="background-color: lightgray; padding: 1px;">' + feature.properties.category + '<span style="float: right;">' + feature.properties.height + ' m</span></div><div style="margin-top: 1px;">' + popupContent + '</div>');
                layer.on('mouseover', function (e) {
                    if (feature.properties.category == 'Pass'){
                        id = feature.properties.idd;
                        geoJSONArray[id].setStyle({ color: 'darkblue' ,weight:'3'});
                    } else if (feature.properties.category == 'Climb'){
                        id = feature.properties.idd;
                        geoJSONArray[id].setStyle({ color: 'orange' ,weight:'3'});
                    } else if (feature.properties.category == 'Sackgasse'){
                        id = feature.properties.idd;
                        geoJSONArray[id].setStyle({ color: 'red' ,weight:'3'});
                    }
                });
                layer.on('mouseout', function (e) {
                    if (feature.properties.category == 'Pass'){
                        if (selected[id]) {
                            geoJSONArray[id].setStyle({ color: 'darkblue',weight:'3' }); // Change color
                        } else {
                            geoJSONArray[id].setStyle({ color: 'blue',weight:'1' }); // Restore the old color
                        }
                    } else if (feature.properties.category == 'Climb'){
                        if (selected[id]) {
                            geoJSONArray[id].setStyle({ color: 'orange',weight:'3' }); // Change color
                        } else {
                            geoJSONArray[id].setStyle({ color: 'yellow',weight:'1' }); // Restore the old color
                        }
                    } else if (feature.properties.category == 'Sackgasse'){
                        if (selected[id]) {
                            geoJSONArray[id].setStyle({ color: 'red',weight:'3' }); // Change color
                        } else {
                            geoJSONArray[id].setStyle({ color: 'pink',weight:'1' }); // Restore the old color
                        }
                    }
                });
                layer.on('click', function (e) {
                    id = feature.properties.idd;
                    this.openPopup;
                    document.getElementById('MarkerCheckbox').checked = markerStates[id];
                    // Add a listener for the checkbox change event
                    document.getElementById('MarkerCheckbox').addEventListener('change', function (event) {
                        selected[id] = event.target.checked;
                        markerStates[id] = event.target.checked; // Store the state in markerStates
                        //updateGeoJSONLayerColor();
                        if (feature.properties.category == 'Pass'){
                            if (selected[id]) {
                                geoJSONArray[id].setStyle({ color: 'darkblue',weight:'3' }); // Change color
                            } else {
                                geoJSONArray[id].setStyle({ color: 'blue',weight:'1' }); // Restore the old color
                            } 
                        } else if (feature.properties.category == 'Climb'){
                            if (selected[id]) {
                                geoJSONArray[id].setStyle({ color: 'orange',weight:'3' }); // Change color
                            } else {
                                geoJSONArray[id].setStyle({ color: 'yellow',weight:'1' }); // Restore the old color
                            }
                        } else if (feature.properties.category == 'Sackgasse'){
                            if (selected[id]) {
                                geoJSONArray[id].setStyle({ color: 'red',weight:'3' }); // Change color
                            } else {
                                geoJSONArray[id].setStyle({ color: 'pink',weight:'1' }); // Restore the old color
                            }
                        }
                    });
                }); 
            }
        });
        
        //cluster representation, turned off for identification issues
        /*var markers = L.markerClusterGroup({
            spiderfyOnMaxZoom: true,
            showCoverageOnHover: false,
            zoomToBoundsOnClick: true
        });
        markers.addLayer(marker);
        map.addLayer(markers);*/

        //search master
        var searchElements = L.geoJSON(passi, {
            pointToLayer: function (feature, latlng) {
                return L.marker(latlng, { icon: searchIcon});
            }
        });
        var searchArray = [];
        searchArray.push(searchElements);
        var search = L.layerGroup(searchArray);
        searchControl = new L.Control.Search({
            layer: search,
            propertyName: 'name',
            initial: false,
            casesensitive: 	false,
            zoom: 14,
            hideMarkerOnCollapse: true,
            autoCollapse: false,
            autoCollapseTime: 1
        });
        map.addControl(searchControl);

        //Track sytle and feature functions
        function onEachFeature(feature, layer) {
            layer.bindPopup(function (layer) {
                return '<p style="margin-bottom: 5px;"><a href="' + feature.properties.link + '" target="_blank">' + feature.properties.name + '</a></p> (' + feature.properties.length + ' km' +', ' + feature.properties.elevation + ' hm' + ')<p style="margin-top: 5px;">';
            });
            layer.bindTooltip(feature.properties.name + " (" + feature.properties.elevation + ' hm)');
            layer.on('mouseover', function (e) {
                if (feature.properties.category == 'Climb'){
                    this.setStyle({ color: 'orange', weight: 3 });
                } else if (feature.properties.category == 'Pass'){
                    this.setStyle({ color: 'darkblue', weight: 3 });
                } else if (feature.properties.category == 'Sackgasse'){
                    this.setStyle({ color: 'red', weight: 3 });
                }
            });
            layer.on('mouseout', function (e) {
                if (feature.properties.category == 'Pass'){
                    if (selected[id]) {
                        this.setStyle({ color: 'darkblue',weight:'3' }); // Change color
                    } else {
                        this.setStyle({ color: 'blue',weight:'1' }); // Restore the old color
                    } 
                } else if (feature.properties.category == 'Climb'){
                    if (selected[id]) {
                        this.setStyle({ color: 'orange',weight:'3' }); // Change color
                    } else {
                        this.setStyle({ color: 'yellow',weight:'1' }); // Restore the old color
                    }
                } else if (feature.properties.category == 'Sackgasse'){
                    if (selected[id]) {
                        this.setStyle({ color: 'red',weight:'3' }); // Change color
                    } else {
                        this.setStyle({ color: 'pink',weight:'1' }); // Restore the old color
                    }
                }
            });
        }
        function TrackStyle(feature) {
            if (feature.properties.category == 'Climb') {
                return { color: 'yellow', weight: "1" };
            } else if (feature.properties.category == 'Pass') {
                return { color: 'blue', weight: "1" };
            } else if (feature.properties.category == 'Sackgasse') {
                return { color: 'pink', weight: "1" };
            }  
        }

        //layer button with maps and tracks
        var overlayMaps2 = {};
        var layerControl2 = L.control.layers(null, overlayMaps2,{ position: 'bottomright' }).addTo(map);
        
/////////add new tracks here///////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////        
        var gValcava = L.geoJSON(Valcava, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idValcava = Valcava.features[0].properties.idd;
        geoJSONArray[idValcava] = gValcava;
        geoJSONs.push(gValcava);
        layerControl2.addOverlay(gValcava, "Passo Valcava");

        var gZeno = L.geoJSON(Zeno, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idZeno = Zeno.features[0].properties.idd;
        geoJSONArray[idZeno] = gZeno;
        geoJSONs.push(gZeno);
        layerControl2.addOverlay(gZeno, "Colle di San Zeno");

        var gUmbrail = L.geoJSON(Umbrail, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idUmbrail = Umbrail.features[0].properties.idd;
        geoJSONArray[idUmbrail] = gUmbrail;
        geoJSONs.push(gUmbrail);
        layerControl2.addOverlay(gUmbrail, "Umbrailpass");

        var gTrivigno = L.geoJSON(Trivigno, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idTrivigno = Trivigno.features[0].properties.idd;
        geoJSONArray[idTrivigno] = gTrivigno;
        geoJSONs.push(gTrivigno);
        layerControl2.addOverlay(gTrivigno, "Passo di Trivigno");

        var gMortirolo = L.geoJSON(Mortirolo, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idMortirolo = Mortirolo.features[0].properties.idd;
        geoJSONArray[idMortirolo] = gMortirolo;
        geoJSONs.push(gMortirolo);
        layerControl2.addOverlay(gMortirolo, "Passo del Mortirolo");

        var gSimplon = L.geoJSON(Simplon, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idSimplon = Simplon.features[0].properties.idd;
        geoJSONArray[idSimplon] = gSimplon;
        geoJSONs.push(gSimplon);
        layerControl2.addOverlay(gSimplon, "Simplonpass");

        var gPresolana = L.geoJSON(Presolana, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idPresolana = Presolana.features[0].properties.idd;
        geoJSONArray[idPresolana] = gPresolana;
        geoJSONs.push(gPresolana);
        layerControl2.addOverlay(gPresolana, "Passo della Presolana");

        var gNeggia = L.geoJSON(Neggia, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idNeggia = Neggia.features[0].properties.idd;
        geoJSONArray[idNeggia] = gNeggia;
        geoJSONs.push(gNeggia);
        layerControl2.addOverlay(gNeggia, "Alpe di Neggia");

        var gNufenen = L.geoJSON(Nufenen, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idNufenen = Nufenen.features[0].properties.idd;
        geoJSONArray[idNufenen] = gNufenen;
        geoJSONs.push(gNufenen);
        layerControl2.addOverlay(gNufenen, "Nufenenpass");

        var gTedesco = L.geoJSON(Tedesco, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idTedesco = Tedesco.features[0].properties.idd;
        geoJSONArray[idTedesco] = gTedesco;
        geoJSONs.push(gTedesco);
        layerControl2.addOverlay(gTedesco, "Alpe del Tedesco");

        var gTonale = L.geoJSON(Tonale, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idTonale = Tonale.features[0].properties.idd;
        geoJSONArray[idTonale] = gTonale;
        geoJSONs.push(gTonale);
        layerControl2.addOverlay(gTonale, "Passo del Tonale");

        var gMontecampione = L.geoJSON(Montecampione, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idMontecampione = Montecampione.features[0].properties.idd;
        geoJSONArray[idMontecampione] = gMontecampione;
        geoJSONs.push(gMontecampione);
        layerControl2.addOverlay(gMontecampione, "Pian di Montecampione");

        var gOfen = L.geoJSON(Ofen, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idOfen = Ofen.features[0].properties.idd;
        geoJSONArray[idOfen] = gOfen;
        geoJSONs.push(gOfen);
        layerControl2.addOverlay(gOfen, "Ofenpass, Pass dal Fuorn");

        var gStelvio = L.geoJSON(Stelvio, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idStelvio = Stelvio.features[0].properties.idd;
        geoJSONArray[idStelvio] = gStelvio;
        geoJSONs.push(gStelvio);
        layerControl2.addOverlay(gStelvio, "Passo dello Stelvio, Stilfser Joch");

        var gOberalp = L.geoJSON(Oberalp, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idOberalp = Oberalp.features[0].properties.idd;
        geoJSONArray[idOberalp] = gOberalp;
        geoJSONs.push(gOberalp);
        layerControl2.addOverlay(gOberalp, "Oberalppass");

        var gManiva = L.geoJSON(Maniva, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idManiva = Maniva.features[0].properties.idd;
        geoJSONArray[idManiva] = gManiva;
        geoJSONs.push(gManiva);
        layerControl2.addOverlay(gManiva, "Giogo del Maniva");

        var gMarzio = L.geoJSON(Marzio, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idMarzio = Marzio.features[0].properties.idd;
        geoJSONArray[idMarzio] = gMarzio;
        geoJSONs.push(gMarzio);
        layerControl2.addOverlay(gMarzio, "Forcorella di Marzio");

        var gGrimsel = L.geoJSON(Grimsel, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idGrimsel = Grimsel.features[0].properties.idd;
        geoJSONArray[idGrimsel] = gGrimsel;
        geoJSONs.push(gGrimsel);
        layerControl2.addOverlay(gGrimsel, "Grimselpass");

        var gLukmanier = L.geoJSON(Lukmanier, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idLukmanier = Lukmanier.features[0].properties.idd;
        geoJSONArray[idLukmanier] = gLukmanier;
        geoJSONs.push(gLukmanier);
        layerControl2.addOverlay(gLukmanier, "Lukmanierpass");

        var gLivigno = L.geoJSON(Livigno, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idLivigno = Livigno.features[0].properties.idd;
        geoJSONArray[idLivigno] = gLivigno;
        geoJSONs.push(gLivigno);
        layerControl2.addOverlay(gLivigno, "Forcola di Livigno");

        var gGuspessa = L.geoJSON(Guspessa, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idGuspessa = Guspessa.features[0].properties.idd;
        geoJSONArray[idGuspessa] = gGuspessa;
        geoJSONs.push(gGuspessa);
        layerControl2.addOverlay(gGuspessa, "Passo di Guspessa");

        var gEira = L.geoJSON(Eira, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idEira = Eira.features[0].properties.idd;
        geoJSONArray[idEira] = gEira;
        geoJSONs.push(gEira);
        layerControl2.addOverlay(gEira, "Passo d'Eira");

        var gGottardo = L.geoJSON(Gottardo, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idGottardo = Gottardo.features[0].properties.idd;
        geoJSONArray[idGottardo] = gGottardo;
        geoJSONs.push(gGottardo);
        layerControl2.addOverlay(gGottardo, "St. Gotthardpass");

        var gGranBernard = L.geoJSON(GranBernard, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idGranBernard = GranBernard.features[0].properties.idd;
        geoJSONArray[idGranBernard] = gGranBernard;
        geoJSONs.push(gGranBernard);
        layerControl2.addOverlay(gGranBernard, "Col du Grand Saint Bernard");

        var gGavia = L.geoJSON(Gavia, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idGavia = Gavia.features[0].properties.idd;
        geoJSONArray[idGavia] = gGavia;
        geoJSONs.push(gGavia);
        layerControl2.addOverlay(gGavia, "Passo di Gavia");

        var gForcora = L.geoJSON(Forcora, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idForcora = Forcora.features[0].properties.idd;
        geoJSONArray[idForcora] = gForcora;
        geoJSONs.push(gForcora);
        layerControl2.addOverlay(gForcora, "Passo Forcora");

        var gFurka = L.geoJSON(Furka, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idFurka = Furka.features[0].properties.idd;
        geoJSONArray[idFurka] = gFurka;
        geoJSONs.push(gFurka);
        layerControl2.addOverlay(gFurka, "Furkapass");

        var gFoscagno = L.geoJSON(Foscagno, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idFoscagno = Foscagno.features[0].properties.idd;
        geoJSONArray[idFoscagno] = gFoscagno;
        geoJSONs.push(gFoscagno);
        layerControl2.addOverlay(gFoscagno, "Passo di Foscagno");

        var gCrocedomini = L.geoJSON(Crocedomini, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idCrocedomini = Crocedomini.features[0].properties.idd;
        geoJSONArray[idCrocedomini] = gCrocedomini;
        geoJSONs.push(gCrocedomini);
        layerControl2.addOverlay(gCrocedomini, "Passo di Crocedomini");

        var gAprica = L.geoJSON(Aprica, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idAprica = Aprica.features[0].properties.idd;
        geoJSONArray[idAprica] = gAprica;
        geoJSONs.push(gAprica);
        layerControl2.addOverlay(gAprica, "Passo dell'Aprica");

        var gJulier = L.geoJSON(Julier, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idJulier = Julier.features[0].properties.idd;
        geoJSONArray[idJulier] = gJulier;
        geoJSONs.push(gJulier);
        layerControl2.addOverlay(gJulier, "Julierpass");

        var gBernina = L.geoJSON(Bernina, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idBernina = Bernina.features[0].properties.idd;
        geoJSONArray[idBernina] = gBernina;
        geoJSONs.push(gBernina);
        layerControl2.addOverlay(gBernina, "Berninapass, Passo del Bernina");

        var gVivione = L.geoJSON(Vivione, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idVivione = Vivione.features[0].properties.idd;
        geoJSONArray[idVivione] = gVivione;
        geoJSONs.push(gVivione);
        layerControl2.addOverlay(gVivione, "Passo del Vivione");

        var gAlbula = L.geoJSON(Albula, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idAlbula = Albula.features[0].properties.idd;
        geoJSONArray[idAlbula] = gAlbula;
        geoJSONs.push(gAlbula);
        layerControl2.addOverlay(gAlbula, "Albulapass");

        var gMaloja = L.geoJSON(Maloja, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idMaloja = Maloja.features[0].properties.idd;
        geoJSONArray[idMaloja] = gMaloja;
        geoJSONs.push(gMaloja);
        layerControl2.addOverlay(gMaloja, "Malojapass");

        var gBernardino = L.geoJSON(Bernardino, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idBernardino = Bernardino.features[0].properties.idd;
        geoJSONArray[idBernardino] = gBernardino;
        geoJSONs.push(gBernardino);
        layerControl2.addOverlay(gBernardino, "San-Bernardino-Pass");

        var gSplugen = L.geoJSON(Splugen, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idSplugen = Splugen.features[0].properties.idd;
        geoJSONArray[idSplugen] = gSplugen;
        geoJSONs.push(gSplugen);
        layerControl2.addOverlay(gSplugen, "Passo dello Spluga");

        var gBalisio = L.geoJSON(Balisio, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idBalisio = Balisio.features[0].properties.idd;
        geoJSONArray[idBalisio] = gBalisio;
        geoJSONs.push(gBalisio);
        layerControl2.addOverlay(gBalisio, "Colle Balisio");

        var gBura = L.geoJSON(Bura, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idBura = Bura.features[0].properties.idd;
        geoJSONArray[idBura] = gBura;
        geoJSONs.push(gBura);
        layerControl2.addOverlay(gBura, "Passo Forcella di Bura");

        var gAntonio = L.geoJSON(Antonio, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idAntonio = Antonio.features[0].properties.idd;
        geoJSONArray[idAntonio] = gAntonio;
        geoJSONs.push(gAntonio);
        layerControl2.addOverlay(gAntonio, "Sant'Antonio Abbandonato");


        var gFuipiano = L.geoJSON(Fuipiano, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idFuipiano = Fuipiano.features[0].properties.idd;
        geoJSONArray[idFuipiano] = gFuipiano;
        geoJSONs.push(gFuipiano);
        layerControl2.addOverlay(gFuipiano, "Fuipiano");

        var gBerbenno = L.geoJSON(Berbenno, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idBerbenno = Berbenno.features[0].properties.idd;
        geoJSONArray[idBerbenno] = gBerbenno;
        geoJSONs.push(gBerbenno);
        layerControl2.addOverlay(gBerbenno, "Berbenno");

        var gMiragolo = L.geoJSON(Miragolo, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idMiragolo = Miragolo.features[0].properties.idd;
        geoJSONArray[idMiragolo] = gMiragolo;
        geoJSONs.push(gMiragolo);
        layerControl2.addOverlay(gMiragolo, "Miragolo San Salvatore");

        var gValvarrone = L.geoJSON(Valvarrone, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idValvarrone = Valvarrone.features[0].properties.idd;
        geoJSONArray[idValvarrone] = gValvarrone;
        geoJSONs.push(gValvarrone);
        layerControl2.addOverlay(gValvarrone, "Valvarrone");

        var gMarco = L.geoJSON(Marco, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idMarco = Marco.features[0].properties.idd;
        geoJSONArray[idMarco] = gMarco;
        geoJSONs.push(gMarco);
        layerControl2.addOverlay(gMarco, "Passo San Marco");


        var gCulmine = L.geoJSON(Culmine, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idCulmine = Culmine.features[0].properties.idd;
        geoJSONArray[idCulmine] = gCulmine;
        geoJSONs.push(gCulmine);
        layerControl2.addOverlay(gCulmine, "Passo Culmine di San Pietro");

        var gNespello = L.geoJSON(Nespello, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idNespello = Nespello.features[0].properties.idd;
        geoJSONArray[idNespello] = gNespello;
        geoJSONs.push(gNespello);
        layerControl2.addOverlay(gNespello, "Forcella di Nespello");

        var gAgueglio = L.geoJSON(Agueglio, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idAgueglio = Agueglio.features[0].properties.idd;
        geoJSONArray[idAgueglio] = gAgueglio;
        geoJSONs.push(gAgueglio);
        layerControl2.addOverlay(gAgueglio, "Passo Agueglio");

        var gNarro = L.geoJSON(Narro, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idNarro = Narro.features[0].properties.idd;
        geoJSONArray[idNarro] = gNarro;
        geoJSONs.push(gNarro);
        layerControl2.addOverlay(gNarro, "Narro");

        var gSalmezza = L.geoJSON(Salmezza, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idSalmezza = Salmezza.features[0].properties.idd;
        geoJSONArray[idSalmezza] = gSalmezza;
        geoJSONs.push(gSalmezza);
        layerControl2.addOverlay(gSalmezza, "Valico di Salmezza");


        var gMontevecchia = L.geoJSON(Montevecchia, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idMontevecchia = Montevecchia.features[0].properties.idd;
        geoJSONArray[idMontevecchia] = gMontevecchia;
        geoJSONs.push(gMontevecchia);
        layerControl2.addOverlay(gMontevecchia, "Montevecchia");

        var gPrimo = L.geoJSON(Primo, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idPrimo = Primo.features[0].properties.idd;
        geoJSONArray[idPrimo] = gPrimo;
        geoJSONs.push(gPrimo);
        layerControl2.addOverlay(gPrimo, "Monte San Primo");

        var gSormano = L.geoJSON(Sormano, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idSormano = Sormano.features[0].properties.idd;
        geoJSONArray[idSormano] = gSormano;
        geoJSONs.push(gSormano);
        layerControl2.addOverlay(gSormano, "Colma di Sormano");

        var gMadonnina = L.geoJSON(Madonnina, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idMadonnina = Madonnina.features[0].properties.idd;
        geoJSONArray[idMadonnina] = gMadonnina;
        geoJSONs.push(gMadonnina);
        layerControl2.addOverlay(gMadonnina, "Colle della Madonnina");

        var gValbrona = L.geoJSON(Valbrona, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idValbrona = Valbrona.features[0].properties.idd;
        geoJSONArray[idValbrona] = gValbrona;
        geoJSONs.push(gValbrona);
        layerControl2.addOverlay(gValbrona, "Sella di Valbrona");

        var gGhisallo = L.geoJSON(Ghisallo, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idGhisallo = Ghisallo.features[0].properties.idd;
        geoJSONArray[idGhisallo] = gGhisallo;
        geoJSONs.push(gGhisallo);
        layerControl2.addOverlay(gGhisallo, "Madonna del Ghisallo");

        var gIseran = L.geoJSON(Iseran, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idIseran = Iseran.features[0].properties.idd;
        geoJSONArray[idIseran] = gIseran;
        geoJSONs.push(gIseran);
        layerControl2.addOverlay(gIseran, "Col d\'Iseran");

        var gZambla = L.geoJSON(Zambla, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idZambla = Zambla.features[0].properties.idd;
        geoJSONArray[idZambla] = gZambla;
        geoJSONs.push(gZambla);
        layerControl2.addOverlay(gZambla, "Passo di Zambla");

        var gSelvino = L.geoJSON(Selvino, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idSelvino = Selvino.features[0].properties.idd;
        geoJSONArray[idSelvino] = gSelvino;
        geoJSONs.push(gSelvino);
        layerControl2.addOverlay(gSelvino, "Selvino");

        var gGanda = L.geoJSON(Ganda, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idGanda = Ganda.features[0].properties.idd;
        geoJSONArray[idGanda] = gGanda;
        geoJSONs.push(gGanda);
        layerControl2.addOverlay(gGanda, "Passo di Ganda");

        var gBrianza = L.geoJSON(Brianza, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idBrianza = Brianza.features[0].properties.idd;
        geoJSONArray[idBrianza] = gBrianza;
        geoJSONs.push(gBrianza);
        layerControl2.addOverlay(gBrianza, "Colle di Brianza");

        var gSusten = L.geoJSON(Susten, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idSusten = Susten.features[0].properties.idd;
        geoJSONArray[idSusten] = gSusten;
        geoJSONs.push(gSusten);
        layerControl2.addOverlay(gSusten, "Sustenpass");
///////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////        
        //table data
        var lengthArray = [];
        var elevationArray = [];
        var slopeArray = [];
        var trackArray1 = [];
        var trackArray2 = [];
        var trackArray3 = [];
        var trackArray4 = [];
        var trackArray5 = [];
        var addInfo = [];
        var j = 0;
        for (j=0; j<=685; j++){
            lengthArray[j] = 0;
            elevationArray[j] = 0;
            slopeArray[j] = 0;
        }
        trackTable = geoJSONArray;
        trackTable.forEach(function (layer) {
            const features = layer.getLayers();
            features.forEach(function (featureLayer) {
                const idd = featureLayer.feature.properties.idd;
                const length = featureLayer.feature.properties.length;
                const elevation = featureLayer.feature.properties.elevation;
                const name = featureLayer.feature.properties.name;
                const slopeOrig = (elevation/(length*1000))*100;
                const slope = slopeOrig.toFixed(1);
                const id = featureLayer.feature.properties.id;

                if (length >= lengthArray[idd]){lengthArray[idd] = length};
                if (elevation >= elevationArray[idd]){elevationArray[idd] = elevation}; 
                if (slope >= slopeArray[idd]){slopeArray[idd] = slope}; 
            });
        });
        markerTable.push(marker);
        markerTable.forEach(function (layer) {
            const features = layer.getLayers();
            features.forEach(function (featureLayer) {
                const name = featureLayer.feature.properties.name;
                const height = featureLayer.feature.properties.height;
                const country = featureLayer.feature.properties.country;
                const idd = featureLayer.feature.properties.idd;
                const link = featureLayer.feature.properties.link;
                var length = lengthArray[idd];
                var elevation = elevationArray[idd];
                var slope = slopeArray[idd];

                addInfo = [];
                if (lengthArray[idd] > 0.1){
                    const layer = trackTable[idd];
                    const numberOfFeatures = layer.getLayers().length;
                    var j;
                    for (j=0; j<=numberOfFeatures-1; j++){
                        trackArray1[j] = geoJSONArray[idd].getLayers()[j].feature.properties.name;
                        trackArray2[j] = geoJSONArray[idd].getLayers()[j].feature.properties.length;
                        trackArray3[j] = geoJSONArray[idd].getLayers()[j].feature.properties.elevation;
                        trackArray4[j] = ((geoJSONArray[idd].getLayers()[j].feature.properties.elevation/((geoJSONArray[idd].getLayers()[j].feature.properties.length)*1000))*100).toFixed(1);
                        trackArray5[j] = geoJSONArray[idd].getLayers()[j].feature.properties.link;
                        addInfo[j] = trackArray1[j] +  " (" + trackArray2[j] + ' km, ' + trackArray3[j] + ' hm, ' + trackArray4[j] + ' %)'
                    }
                    
                } else {
                    addInfo = ["Info 1", "Info 2", "Info 3"];
                }
 
                const tableRow = createRow(idd, name, country, height, length, elevation, slope, addInfo);

                dataBody.appendChild(tableRow);
            });
        });

        function checkboxCallback(idd, isChecked) {
            if (isChecked) {
                geoJSONArray[idd].addTo(map);
                marker.eachLayer(function (layer) {
                    const iddd = layer.feature.properties.idd;
                    if (iddd === idd) {
                        layer.addTo(map);
                    }
                });
            } else {
                map.removeLayer(geoJSONArray[idd]);
                marker.eachLayer(function (layer) {
                    const iddd = layer.feature.properties.idd;
                    if (iddd === idd) {
                        map.removeLayer(layer);
                    }
                });
            }
        }

        // variables
        var MarkersSelected = false;
        var ItalySelected = false;
        var FranceSelected = false;
        var SuisseSelected = false;
        var AustriaSelected = false;
        var GermanySelected = false;
        var text;
        var markersCheckbox;
        var italyCheckbox;
        var suisseCheckbox;
        var franceCheckbox;
        var austriaCheckbox;
        var germanyCheckbox;
        var geoIDArray = [];
        var markerIDArray = [];
        var allArray = [];
        var italyArray = [];
        var franceArray = [];
        var suisseArray = [];
        var austriaArray = [];
        var germanyArray = [];
        var iddArray = [];
        
        var italy1 = L.layerGroup([]);
        var france1 = L.layerGroup([]);
        var suisse1 = L.layerGroup([]);
        var austria1 = L.layerGroup([]);
        var germany1 = L.layerGroup([]);

        var all= L.layerGroup([]);;
        var italy = L.layerGroup([]);
        var france = L.layerGroup([]);
        var suisse = L.layerGroup([]);
        var austria = L.layerGroup([]);
        var germany = L.layerGroup([]);

        var baseMaps = {
            "Standard": osm,
            "Satellite": satellite,
            "Topo": topo
        };
        var overlayMaps1= {
            "All": all,
            "Italy": italy,
            "Suisse": suisse,
            "France": france,
            "Austria": austria,
            "Germany": germany
        };
        var layerControl = L.control.layers(baseMaps, overlayMaps1,{position: 'topright'}).addTo(map);

        filterGeoJSONObjects();

        // Function to filter GeoJSON objects based on selected categories
        function filterGeoJSONObjects() {
            allArray = [];
            italyArray = [];
            franceArray = [];
            suisseArray = [];
            austriaArray = [];
            germanyArray = [];
            markerIDArray = [];
            geoIDArray = [];

            var markerClick = MarkersSelected;
            var italyClick = ItalySelected;
            var franceClick = FranceSelected;
            var suisseClick = SuisseSelected;
            var austriaClick = AustriaSelected;
            var germanyClick = GermanySelected;

            if (MarkersSelected){ markersCheckbox.click()};
            if (ItalySelected){ italyCheckbox.click()};
            if (FranceSelected){ franceCheckbox.click()};
            if (SuisseSelected){ suisseCheckbox.click()};
            if (AustriaSelected){ austriaCheckbox.click()};
            if (GermanySelected){ germanyCheckbox.click()};

            marks.push(marker);
            marks.forEach(function (layer) {
                const features = layer.getLayers();
                features.forEach(function (featureLayer) {
                    const country = featureLayer.feature.properties.country;
                    const category = featureLayer.feature.properties.category;
                    const height = featureLayer.feature.properties.height;
                    const idd = featureLayer.feature.properties.idd;
                    if((((category === 'Pass' && FilterArray[0]) || (category === 'Climb' && FilterArray[1]) || (category == 'Sackgasse' && FilterArray[2])) || (!FilterArray[0] && !FilterArray[1] && !FilterArray[2])) && height >= FilterArray[3] && height <= FilterArray[4]){
                        markerIDArray[idd] = idd;
                    }
                }); 
            });

            geoJSONArray.forEach(function (layer) {
                const features = layer.getLayers();
                features.forEach(function (featureLayer) {
                    const country = featureLayer.feature.properties.country;
                    const category = featureLayer.feature.properties.category;
                    const length = featureLayer.feature.properties.length;
                    const elevation = featureLayer.feature.properties.elevation;
                    const slope = (elevation/(length*1000))*100;
                    const idd = featureLayer.feature.properties.idd;
                    if((((category === 'Pass' && FilterArray[0]) || (category === 'Climb' && FilterArray[1]) || (category == 'Sackgasse' && FilterArray[2])) || (!FilterArray[0] && !FilterArray[1] && !FilterArray[2])) && length >= FilterArray[7] && length <= FilterArray[8] && elevation >= FilterArray[5] && elevation <= FilterArray[6] && slope >= FilterArray[9] && slope <= FilterArray[10]){
                        geoIDArray[idd] = idd;
                    }
                });
            });

            iddArray = [];
            var k = 683;
            for (i=0; i<=k; i++){
                if (geoIDArray[i] == i && markerIDArray[i] == i){
                    iddArray[i] = i;
                }
            }

            marks.forEach(function (layer) {
                const features = layer.getLayers();
                features.forEach(function (featureLayer) {
                    const country = featureLayer.feature.properties.country;
                    const idd = featureLayer.feature.properties.idd;
                    if (iddArray[idd] == idd && country === 'IT'){
                        italyArray.push(featureLayer);
                    }
                    else if (iddArray[idd] == idd && country === 'FR'){
                        franceArray.push(featureLayer);
                    }
                    else if (iddArray[idd] == idd && country === 'CH'){
                        suisseArray.push(featureLayer);
                    }
                    else if (iddArray[idd] == idd && country === 'AT'){
                        austriaArray.push(featureLayer);
                    }
                    else if (iddArray[idd] == idd && country === 'DE'){
                        germanyArray.push(featureLayer);
                    }
                }); 
            });

            geoJSONArray.forEach(function (layer) {
                const features = layer.getLayers();
                features.forEach(function (featureLayer) {
                    const country = featureLayer.feature.properties.country;
                    const idd = featureLayer.feature.properties.idd;
                    if (iddArray[idd] == idd && country === 'IT'){
                        italyArray.push(featureLayer);
                    }
                    else if (iddArray[idd] == idd && country === 'FR'){
                        franceArray.push(featureLayer);
                    }
                    else if (iddArray[idd] == idd && country === 'CH'){
                        suisseArray.push(featureLayer);
                    }
                    else if (iddArray[idd] == idd && country === 'AT'){
                        austriaArray.push(featureLayer);
                    }
                    else if (iddArray[idd] == idd && country === 'DE'){
                        germanyArray.push(featureLayer);
                    }
                });
            });

            layerControl.removeLayer(italy1);
            layerControl.removeLayer(france1);
            layerControl.removeLayer(suisse1);
            layerControl.removeLayer(austria1);
            layerControl.removeLayer(germany1);

            layerControl.removeLayer(all);
            layerControl.removeLayer(italy);
            layerControl.removeLayer(suisse);
            layerControl.removeLayer(france);
            layerControl.removeLayer(austria);
            layerControl.removeLayer(germany);

            italy1 = L.layerGroup(italyArray);
            france1 = L.layerGroup(franceArray);
            suisse1 = L.layerGroup(suisseArray);
            austria1 = L.layerGroup(austriaArray);
            germany1 = L.layerGroup(germanyArray);

            all = L.layerGroup([italy1, france1, suisse1, austria1, germany1]);
            italy = L.layerGroup(italyArray);
            france = L.layerGroup(franceArray);
            suisse = L.layerGroup(suisseArray);
            austria = L.layerGroup(austriaArray);
            germany = L.layerGroup(germanyArray);
            
            layerControl.addOverlay(all, "All");
            layerControl.addOverlay(italy, "Italy");
            layerControl.addOverlay(suisse, "Suisse");
            layerControl.addOverlay(france, "France");
            layerControl.addOverlay(austria, "Austria");
            layerControl.addOverlay(germany, "Germany");

            labels = 0;
            labels = layerControl.getContainer().querySelectorAll('label');
            clickevents();

            if (markerClick){ markersCheckbox.click()};
            if (italyClick){ italyCheckbox.click()};
            if (franceClick){ franceCheckbox.click()};
            if (suisseClick){ suisseCheckbox.click()};
            if (austriaClick){ austriaCheckbox.click()};
            if (germanyClick){ germanyCheckbox.click()};
        };

        // Add event listeners to the checkboxes
        document.getElementById('applyFilter').addEventListener('click', filterGeoJSONObjects);
        document.getElementById('resetFilter').addEventListener('click', filterGeoJSONObjects);
        
        //layer control button selection
        function clickevents(){
            labels.forEach(function (label) {
                text = label.textContent.trim();
                if (text === 'All') {
                    markersCheckbox = label.querySelector('input[type="checkbox"]');
                    if (markersCheckbox) {
                        markersCheckbox.addEventListener('click', function (e) {
                            MarkersSelected = e.target.checked;
                            if (MarkersSelected){
                                if (ItalySelected){
                                    italyCheckbox.click();
                                }
                                if (FranceSelected){
                                    franceCheckbox.click();
                                }
                                if (SuisseSelected){
                                    suisseCheckbox.click();
                                }
                                if (AustriaSelected){
                                    austriaCheckbox.click();
                                }
                                if (GermanySelected){
                                    germanyCheckbox.click();
                                }
                                markersCheckbox.click();
                                markersCheckbox.click();
                            }
                        });
                    }
                } else if (text === 'Italy') {
                    italyCheckbox = label.querySelector('input[type="checkbox"]');
                    if (italyCheckbox) {
                        italyCheckbox.addEventListener('click', function (e) {
                            ItalySelected = e.target.checked;
                            if (ItalySelected){
                                if (MarkersSelected){
                                    markersCheckbox.click();
                                    italyCheckbox.click();
                                    italyCheckbox.click();
                                }
                            }
                        });
                    }
                } else if (text === 'France') {
                    franceCheckbox = label.querySelector('input[type="checkbox"]');
                    if (franceCheckbox) {
                        franceCheckbox.addEventListener('click', function (e) {
                            FranceSelected = e.target.checked; 
                            if (FranceSelected){
                                if (MarkersSelected){
                                    markersCheckbox.click();
                                    franceCheckbox.click();
                                    franceCheckbox.click();
                                }
                            }
                        });
                    }
                } else if (text === 'Suisse') {
                    suisseCheckbox = label.querySelector('input[type="checkbox"]');
                    if (suisseCheckbox) {
                        suisseCheckbox.addEventListener('click', function (e) {
                            SuisseSelected = e.target.checked;
                            if (SuisseSelected){
                                if (MarkersSelected){
                                    markersCheckbox.click();
                                    suisseCheckbox.click();
                                    suisseCheckbox.click();
                                }
                            }
                        });
                    }
                } else if (text === 'Austria') {
                    austriaCheckbox = label.querySelector('input[type="checkbox"]');
                    if (austriaCheckbox) {
                        austriaCheckbox.addEventListener('click', function (e) {
                            AustriaSelected = e.target.checked;
                            if (AustriaSelected){
                                if (MarkersSelected){
                                    markersCheckbox.click();
                                    austriaCheckbox.click();
                                    austriaCheckbox.click();
                                }
                            }
                        });
                    }
                } else if (text === 'Germany') {
                    germanyCheckbox = label.querySelector('input[type="checkbox"]');
                    if (germanyCheckbox) {
                        germanyCheckbox.addEventListener('click', function (e) {
                            GermanySelected = e.target.checked;
                            if (GermanySelected){
                                if (MarkersSelected){
                                    markersCheckbox.click();
                                    germanyCheckbox.click();
                                    germanyCheckbox.click();
                                }
                            }
                        });
                    }
                }
            });
        }   
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <title>MyMap</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Leaflet -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

    <!-- search box -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />
    <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>

    <!-- location-->
    <link rel="stylesheet" href="leaflet-locatecontrol-gh-pages\dist\L.Control.Locate.mapbox.min.css"/>
    <script src="leaflet-locatecontrol-gh-pages\dist\L.Control.Locate.min.js"></script>

    <!-- cluster-->
    <link rel="stylesheet" href="Leaflet.markercluster-1.4.1\dist\MarkerCluster.css"/>
    <link rel="stylesheet" href="Leaflet.markercluster-1.4.1\dist\MarkerCluster.Default.css"/>
    <script src="Leaflet.markercluster-1.4.1\dist\leaflet.markercluster-src.js"></script>
    <script src="Leaflet.markercluster-1.4.1\dist\leaflet.markercluster.js"></script>
    
    <!-- marker search -->
    <link rel="stylesheet" href="leaflet-search-master\dist\leaflet-search.src.css"/>
    <script src="leaflet-search-master\dist\leaflet-search.src.js"></script>

    <!-- style -->
    <style>
        #map {position: absolute; top: 0; bottom: 0; left: 0; right: 0}
    </style>

    <!--------------------- add geoJSON files renamed to .js files here -------------------------------------->
    <!-------------------------------------------------------------------------------------------------------->
    <script src = "passi.js"></script>
    <script src = "Tracks/Valcava.js"></script>
    <script src = "Tracks/Iseran.js"></script>
    <script src = "Tracks/Zambla.js"></script>
    <script src = "Tracks/Selvino.js"></script>
    <script src = "Tracks/Ganda.js"></script>
    <script src = "Tracks/Brianza.js"></script>
    <script src = "Tracks/Ghisallo.js"></script>
    <script src = "Tracks/Sormano.js"></script>
    <script src = "Tracks/Valbrona.js"></script>
    <script src = "Tracks/Madonnina.js"></script>
    <script src = "Tracks/Primo.js"></script>
    <script src = "Tracks/Montevecchia.js"></script>
    <script src = "Tracks/Miragolo.js"></script>
    <script src = "Tracks/Salmezza.js"></script>
    <script src = "Tracks/Nespello.js"></script>
    <script src = "Tracks/Culmine.js"></script>
    <script src = "Tracks/Agueglio.js"></script>
    <script src = "Tracks/Narro.js"></script>
    <script src = "Tracks/Valvarrone.js"></script>
    <script src = "Tracks/Marco.js"></script>
    <script src = "Tracks/Berbenno.js"></script>
    <script src = "Tracks/Fuipiano.js"></script>
    <script src = "Tracks/Bura.js"></script>
    <script src = "Tracks/Antonio.js"></script>
    <script src = "Tracks/Balisio.js"></script>
    <script src = "Tracks/Splugen.js"></script>
    <script src = "Tracks/Bernardino.js"></script>
    <script src = "Tracks/Maloja.js"></script>
    <script src = "Tracks/Julier.js"></script>
    <script src = "Tracks/Albula.js"></script>
    <script src = "Tracks/Bernina.js"></script>
    <script src = "Tracks/Vivione.js"></script>
    <!-------------------------------------------------------------------------------------------------------->
    <!-------------------------------------------------------------------------------------------------------->
</head>
<body>
    <div id = "map"></div>
    <script>
        //center coordinates at start
        var map = L.map('map', {
            minZoom: 2,
        }).setView([45.464664, 9.188540],13);

        //search box
        L.Control.geocoder().addTo(map);

        //scale
        L.control.scale({
            metric: true,
            imperial: false,
            maxwidth: 100,
            position: 'bottomleft'
        }).addTo(map);

        //location
        L.control.locate().addTo(map);

        //map at start
        var osm = L.tileLayer('https://api.maptiler.com/maps/basic-v2/{z}/{x}/{y}.png?key=5oOhPnaZPwb4EiDFpWyW', {
            attribution: '<a href="https://www.maptiler.com/copyright/" target="_blank">&copy; MapTiler</a> <a href="https://www.openstreetmap.org/copyright" target="_blank">&copy; OpenStreetMap contributors</a>'
        }).addTo(map);
        //add other maps
        var satellite = L.tileLayer('https://api.maptiler.com/maps/satellite/{z}/{x}/{y}.jpg?key=5oOhPnaZPwb4EiDFpWyW', {
            attribution: '<a href="https://www.maptiler.com/copyright/" target="_blank">&copy; MapTiler</a> <a href="https://www.openstreetmap.org/copyright" target="_blank">&copy; OpenStreetMap contributors</a>'
        });
        var topo = L.tileLayer('https://api.maptiler.com/maps/topo-v2/{z}/{x}/{y}.png?key=5oOhPnaZPwb4EiDFpWyW', {
            attribution: '<a href="https://www.maptiler.com/copyright/" target="_blank">&copy; MapTiler</a> <a href="https://www.openstreetmap.org/copyright" target="_blank">&copy; OpenStreetMap contributors</a>'
        });

        //variables
        var geoJSONArray = [];
        var geoJSONs = [];
        var marks = [];
        var geoIT = [];
        var geoFR = [];
        var geoDE = [];
        var geoAT = [];
        var geoCH = [];
        var geoPass = [];
        var geoClimb = [];
        var geoSack = [];
        var selected = [];
        var id;

        //cluster
        var markers = L.markerClusterGroup({
            spiderfyOnMaxZoom: true,
            showCoverageOnHover: false,
            zoomToBoundsOnClick: true
        });
        
        //marker passes
        var marker = L.geoJSON(passi, {
            onEachFeature: function(feature, layer){
                var popupContent = "<div><input type='checkbox' id='colorCheckbox' /> Show routes </div>";
                layer.bindPopup('<p style="line-height: 1; margin-bottom: 5px;"><a href="' + feature.properties.link + '" target="_blank">' + feature.properties.name + '</a></div><div style="background-color: lightgray; padding: 1px;">' + feature.properties.category + '<span style="float: right;">' + feature.properties.height + ' m</span></div><div style="margin-top: 1px;">' + popupContent + '</div>');
                layer.on('mouseover', function (e) {
                    id = feature.properties.idd;
                    geoJSONArray[id].setStyle({ color: 'red' ,weight:'2'});
                });
                layer.on('mouseout', function (e) {
                    if (selected[id]) {
                        geoJSONArray[id].setStyle({ color: 'red',weight:'2' }); // Change color
                    } else {
                        geoJSONArray[id].setStyle({ color: 'pink',weight:'1' }); // Restore the old color
                    }
                });
                layer.on('click', function (e) {
                    id = feature.properties.idd;
                    this.openPopup;
                    // Add a listener for the checkbox change event
                    document.getElementById('colorCheckbox').addEventListener('change', function (event) {
                        selected[id] = event.target.checked;
                        updateGeoJSONLayerColor();
                    });
                }); 
            }});

        //cluster representation
        markers.addLayer(marker);
        map.addLayer(markers);

        //marker search
        const searchControl = new L.Control.Search({
            layer: marker,
            propertyName: 'name',
            initial: false,
            casesensitive: 	false,
            zoom: 14
        });
        map.addControl(searchControl);

        //Track sytle and feature functions
        function onEachFeature(feature, layer) {
            layer.bindPopup(function (layer) {
                return '<p style="margin-bottom: 5px;"><a href="' + feature.properties.link + '" target="_blank">' + feature.properties.name + '</a></p> (' + feature.properties.length + ', ' + feature.properties.elevation + ')<p style="margin-top: 5px;">';
            });
            layer.on('click', function (e) {
                this.setStyle({ color: 'green', weight: 5 });
            });
            map.on('click', function (e) {
                updateGeoJSONLayerColor();
            });
        }
        function TrackStyle(feature) {
            return { color: 'pink', weight: "1" };
        }

        //layer button with maps and tracks, add new tracks here
        var overlayMaps2 = {};
        var layerControl2 = L.control.layers(null, overlayMaps2,{ position: 'bottomright' }).addTo(map);
        
/////////add new tracks here///////////////////////////////////////////////////////////////////////////////////
        var gValcava = L.geoJSON(Valcava, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idValcava = Valcava.features[0].properties.idd;
        geoJSONArray[idValcava] = gValcava;
        geoJSONs.push(gValcava);
        layerControl2.addOverlay(gValcava, "Passo Valcava");

        var gJulier = L.geoJSON(Julier, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idJulier = Julier.features[0].properties.idd;
        geoJSONArray[idJulier] = gJulier;
        geoJSONs.push(gJulier);
        layerControl2.addOverlay(gJulier, "Julierpass");

        var gBernina = L.geoJSON(Bernina, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idBernina = Bernina.features[0].properties.idd;
        geoJSONArray[idBernina] = gBernina;
        geoJSONs.push(gBernina);
        layerControl2.addOverlay(gBernina, "Berninapass, Passo del Bernina");

        var gVivione = L.geoJSON(Vivione, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idVivione = Vivione.features[0].properties.idd;
        geoJSONArray[idVivione] = gVivione;
        geoJSONs.push(gVivione);
        layerControl2.addOverlay(gVivione, "Passo del Vivione");

        var gAlbula = L.geoJSON(Albula, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idAlbula = Albula.features[0].properties.idd;
        geoJSONArray[idAlbula] = gAlbula;
        geoJSONs.push(gAlbula);
        layerControl2.addOverlay(gAlbula, "Albulapass");

        var gMaloja = L.geoJSON(Maloja, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idMaloja = Maloja.features[0].properties.idd;
        geoJSONArray[idMaloja] = gMaloja;
        geoJSONs.push(gMaloja);
        layerControl2.addOverlay(gMaloja, "Malojapass");

        var gBernardino = L.geoJSON(Bernardino, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idBernardino = Bernardino.features[0].properties.idd;
        geoJSONArray[idBernardino] = gBernardino;
        geoJSONs.push(gBernardino);
        layerControl2.addOverlay(gBernardino, "San-Bernardino-Pass");

        var gSplugen = L.geoJSON(Splugen, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idSplugen = Splugen.features[0].properties.idd;
        geoJSONArray[idSplugen] = gSplugen;
        geoJSONs.push(gSplugen);
        layerControl2.addOverlay(gSplugen, "Passo dello Spluga");

        var gBalisio = L.geoJSON(Balisio, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idBalisio = Balisio.features[0].properties.idd;
        geoJSONArray[idBalisio] = gBalisio;
        geoJSONs.push(gBalisio);
        layerControl2.addOverlay(gBalisio, "Colle Balisio");

        var gBura = L.geoJSON(Bura, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idBura = Bura.features[0].properties.idd;
        geoJSONArray[idBura] = gBura;
        geoJSONs.push(gBura);
        layerControl2.addOverlay(gBura, "Passo Forcella di Bura");

        var gAntonio = L.geoJSON(Antonio, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idAntonio = Antonio.features[0].properties.idd;
        geoJSONArray[idAntonio] = gAntonio;
        geoJSONs.push(gAntonio);
        layerControl2.addOverlay(gAntonio, "Sant'Antonio Abbandonato");


        var gFuipiano = L.geoJSON(Fuipiano, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idFuipiano = Fuipiano.features[0].properties.idd;
        geoJSONArray[idFuipiano] = gFuipiano;
        geoJSONs.push(gFuipiano);
        layerControl2.addOverlay(gFuipiano, "Fuipiano");

        var gBerbenno = L.geoJSON(Berbenno, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idBerbenno = Berbenno.features[0].properties.idd;
        geoJSONArray[idBerbenno] = gBerbenno;
        geoJSONs.push(gBerbenno);
        layerControl2.addOverlay(gBerbenno, "Berbenno");

        var gMiragolo = L.geoJSON(Miragolo, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idMiragolo = Miragolo.features[0].properties.idd;
        geoJSONArray[idMiragolo] = gMiragolo;
        geoJSONs.push(gMiragolo);
        layerControl2.addOverlay(gMiragolo, "Miragolo San Salvatore");

        var gValvarrone = L.geoJSON(Valvarrone, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idValvarrone = Valvarrone.features[0].properties.idd;
        geoJSONArray[idValvarrone] = gValvarrone;
        geoJSONs.push(gValvarrone);
        layerControl2.addOverlay(gValvarrone, "Valvarrone");

        var gMarco = L.geoJSON(Marco, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idMarco = Marco.features[0].properties.idd;
        geoJSONArray[idMarco] = gMarco;
        geoJSONs.push(gMarco);
        layerControl2.addOverlay(gMarco, "Passo San Marco");


        var gCulmine = L.geoJSON(Culmine, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idCulmine = Culmine.features[0].properties.idd;
        geoJSONArray[idCulmine] = gCulmine;
        geoJSONs.push(gCulmine);
        layerControl2.addOverlay(gCulmine, "Passo Culmine di San Pietro");

        var gNespello = L.geoJSON(Nespello, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idNespello = Nespello.features[0].properties.idd;
        geoJSONArray[idNespello] = gNespello;
        geoJSONs.push(gNespello);
        layerControl2.addOverlay(gNespello, "Forcella di Nespello");

        var gAgueglio = L.geoJSON(Agueglio, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idAgueglio = Agueglio.features[0].properties.idd;
        geoJSONArray[idAgueglio] = gAgueglio;
        geoJSONs.push(gAgueglio);
        layerControl2.addOverlay(gAgueglio, "Passo Agueglio");

        var gNarro = L.geoJSON(Narro, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idNarro = Narro.features[0].properties.idd;
        geoJSONArray[idNarro] = gNarro;
        geoJSONs.push(gNarro);
        layerControl2.addOverlay(gNarro, "Narro");

        var gSalmezza = L.geoJSON(Salmezza, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idSalmezza = Salmezza.features[0].properties.idd;
        geoJSONArray[idSalmezza] = gSalmezza;
        geoJSONs.push(gSalmezza);
        layerControl2.addOverlay(gSalmezza, "Valico di Salmezza");


        var gMontevecchia = L.geoJSON(Montevecchia, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idMontevecchia = Montevecchia.features[0].properties.idd;
        geoJSONArray[idMontevecchia] = gMontevecchia;
        geoJSONs.push(gMontevecchia);
        layerControl2.addOverlay(gMontevecchia, "Montevecchia");

        var gPrimo = L.geoJSON(Primo, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idPrimo = Primo.features[0].properties.idd;
        geoJSONArray[idPrimo] = gPrimo;
        geoJSONs.push(gPrimo);
        layerControl2.addOverlay(gPrimo, "Monte San Primo");

        var gSormano = L.geoJSON(Sormano, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idSormano = Sormano.features[0].properties.idd;
        geoJSONArray[idSormano] = gSormano;
        geoJSONs.push(gSormano);
        layerControl2.addOverlay(gSormano, "Colma di Sormano");

        var gMadonnina = L.geoJSON(Madonnina, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idMadonnina = Madonnina.features[0].properties.idd;
        geoJSONArray[idMadonnina] = gMadonnina;
        geoJSONs.push(gMadonnina);
        layerControl2.addOverlay(gMadonnina, "Colle della Madonnina");

        var gValbrona = L.geoJSON(Valbrona, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idValbrona = Valbrona.features[0].properties.idd;
        geoJSONArray[idValbrona] = gValbrona;
        geoJSONs.push(gValbrona);
        layerControl2.addOverlay(gValbrona, "Sella di Valbrona");

        var gGhisallo = L.geoJSON(Ghisallo, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idGhisallo = Ghisallo.features[0].properties.idd;
        geoJSONArray[idGhisallo] = gGhisallo;
        geoJSONs.push(gGhisallo);
        layerControl2.addOverlay(gGhisallo, "Madonna del Ghisallo");

        var gIseran = L.geoJSON(Iseran, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idIseran = Iseran.features[0].properties.idd;
        geoJSONArray[idIseran] = gIseran;
        geoJSONs.push(gIseran);
        layerControl2.addOverlay(gIseran, "Col d\'Iseran");

        var gZambla = L.geoJSON(Zambla, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idZambla = Zambla.features[0].properties.idd;
        geoJSONArray[idZambla] = gZambla;
        geoJSONs.push(gZambla);
        layerControl2.addOverlay(gZambla, "Passo di Zambla");

        var gSelvino = L.geoJSON(Selvino, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idSelvino = Selvino.features[0].properties.idd;
        geoJSONArray[idSelvino] = gSelvino;
        geoJSONs.push(gSelvino);
        layerControl2.addOverlay(gSelvino, "Selvino");

        var gGanda = L.geoJSON(Ganda, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idGanda = Ganda.features[0].properties.idd;
        geoJSONArray[idGanda] = gGanda;
        geoJSONs.push(gGanda);
        layerControl2.addOverlay(gGanda, "Passo di Ganda");

        var gBrianza = L.geoJSON(Brianza, {
            style: TrackStyle,
            onEachFeature: onEachFeature
        });
        var idBrianza = Brianza.features[0].properties.idd;
        geoJSONArray[idBrianza] = gBrianza;
        geoJSONs.push(gBrianza);
        layerControl2.addOverlay(gBrianza, "Colle di Brianza");
///////////////////////////////////////////////////////////////////////////////////////////////////////////////
        
        //function to highlight tracks on map
        function updateGeoJSONLayerColor() {
            if (selected[id]) {
                geoJSONArray[id].setStyle({ color: 'red',weight:'2' }); // Change color
            } else {
                geoJSONArray[id].setStyle({ color: 'pink',weight:'1' }); // Restore the old color
            }
        }

        //layer button 1 for base layers
        geoJSONArray.forEach(function (layer) {
            const features = layer.getLayers();
        
            features.forEach(function (featureLayer) {
                const country = featureLayer.feature.properties.country;
                const category = featureLayer.feature.properties.category;
                if (country === 'IT') {
                    geoIT.push(featureLayer);
                } else if (country === 'FR') {
                    geoFR.push(featureLayer);
                } else if (country === 'DE') {
                    geoDE.push(featureLayer);
                } else if (country === 'AT') {
                    geoAT.push(featureLayer); 
                } else if (country === 'CH') {
                    geoCH.push(featureLayer);
                }
                if (category === 'Pass') {
                    geoPass.push(featureLayer);
                } else if (category === 'Climb') {
                    geoClimb.push(featureLayer);
                } else if (category === 'Sack') {
                    geoSack.push(featureLayer);
                } 
            });
        });
        marks.push(marker);
        marks.forEach(function (layer) {
            const features = layer.getLayers();
            features.forEach(function (featureLayer) {
                const country = featureLayer.feature.properties.country;
                const category = featureLayer.feature.properties.category;
                if (country === 'IT') {
                    geoIT.push(featureLayer);
                } else if (country === 'FR') {
                    geoFR.push(featureLayer);
                } else if (country === 'DE') {
                    geoDE.push(featureLayer);
                } else if (country === 'AT') {
                    geoAT.push(featureLayer); 
                } else if (country === 'CH') {
                    geoCH.push(featureLayer);
                }
                if (category === 'Pass') {
                    geoPass.push(featureLayer);
                } else if (category === 'Climb') {
                    geoClimb.push(featureLayer);
                } else if (category === 'Sack') {
                    geoSack.push(featureLayer);
                } 
            });
        });
        var tracks = L.layerGroup(geoJSONs);
        var marks = L.layerGroup([marker,markers]);
        var italy = L.layerGroup(geoIT);
        var france = L.layerGroup(geoFR);
        var austria = L.layerGroup(geoAT);
        var germany = L.layerGroup(geoDE);
        var suisse = L.layerGroup(geoCH);
        var pass = L.layerGroup(geoPass);
        var climb = L.layerGroup(geoClimb);
        var sack = L.layerGroup(geoSack);
        var baseMaps = {
            "Standard": osm,
            "Satellite": satellite,
            "Topo": topo
        };
        var overlayMaps1 = {
            "All Markers": marks,
            "All Tracks": tracks,
            "Italy": italy,
            "France": france,
            "Austria": austria,
            "Suisse": suisse,
            "Germany": germany,
            "Pass": pass,
            "Climb": climb,
            "Sackgasse": sack
        };
        var layerControl = L.control.layers(baseMaps, overlayMaps1,{ position: 'topright' }).addTo(map);
    </script>
</body>
</html>
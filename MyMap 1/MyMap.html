<!DOCTYPE html>
<html lang="en">
<head>
    <title>MyMap</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

    
    <!-- add geoJSON files renamed to .js files here -->
    <script src = "passi.js"></script>
    <script src = "Tracks/Valcava.js"></script>
    <script src = "Tracks/Iseran.js"></script>
    <script src = "Tracks/Zambla.js"></script>
    <script src = "Tracks/Selvino.js"></script>
    <script src = "Tracks/Ganda.js"></script>


    <!-- search box -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />
    <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>

    <!-- location-->
    <link rel="stylesheet" href="leaflet-locatecontrol-gh-pages\dist\L.Control.Locate.mapbox.min.css"/>
    <script src="leaflet-locatecontrol-gh-pages\dist\L.Control.Locate.min.js"></script>

    <!-- cluster -->
    <link rel="stylesheet" href="Leaflet.markercluster-1.4.1\dist\MarkerCluster.css"/>
    <link rel="stylesheet" href="Leaflet.markercluster-1.4.1\dist\MarkerCluster.Default.css"/>
    <script src="Leaflet.markercluster-1.4.1\dist\leaflet.markercluster-src.js"></script>
    <script src="Leaflet.markercluster-1.4.1\dist\leaflet.markercluster.js"></script>

    <!-- marker search -->
    <link rel="stylesheet" href="leaflet-search-master\dist\leaflet-search.src.css"/>
    <script src="leaflet-search-master\dist\leaflet-search.src.js"></script>


    <style>
        #map {position: absolute; top: 0; bottom: 0; left: 0; right: 0}
    </style>
</head>
<body>
    <div id = "map"></div>
    <script>
        //center coordinates at start
        var map = L.map('map', {
            minZoom: 2
        }).setView([45.464664, 9.188540],13);

        //search box
        L.Control.geocoder().addTo(map);

        //scale
        L.control.scale({
            metric: true,
            imperial: false,
            maxwidth: 100,
            position: 'bottomleft'
        }).addTo(map);

        //location
        L.control.locate().addTo(map);

        //map at start
        var osm = L.tileLayer('https://api.maptiler.com/maps/basic-v2/{z}/{x}/{y}.png?key=5oOhPnaZPwb4EiDFpWyW', {
            attribution: '<a href="https://www.maptiler.com/copyright/" target="_blank">&copy; MapTiler</a> <a href="https://www.openstreetmap.org/copyright" target="_blank">&copy; OpenStreetMap contributors</a>'
        }).addTo(map);

        //add other maps
        var satellite = L.tileLayer('https://api.maptiler.com/maps/satellite/{z}/{x}/{y}.jpg?key=5oOhPnaZPwb4EiDFpWyW', {
            attribution: '<a href="https://www.maptiler.com/copyright/" target="_blank">&copy; MapTiler</a> <a href="https://www.openstreetmap.org/copyright" target="_blank">&copy; OpenStreetMap contributors</a>'
        });

        var streets = L.tileLayer('https://api.maptiler.com/maps/streets-v2/{z}/{x}/{y}.png?key=5oOhPnaZPwb4EiDFpWyW', {
            attribution: '<a href="https://www.maptiler.com/copyright/" target="_blank">&copy; MapTiler</a> <a href="https://www.openstreetmap.org/copyright" target="_blank">&copy; OpenStreetMap contributors</a>'
        });

        var outdoor = L.tileLayer('https://api.maptiler.com/maps/outdoor-v2/{z}/{x}/{y}.png?key=5oOhPnaZPwb4EiDFpWyW', {
            attribution: '<a href="https://www.maptiler.com/copyright/" target="_blank">&copy; MapTiler</a> <a href="https://www.openstreetmap.org/copyright" target="_blank">&copy; OpenStreetMap contributors</a>'
        });

        var topo = L.tileLayer('https://api.maptiler.com/maps/topo-v2/{z}/{x}/{y}.png?key=5oOhPnaZPwb4EiDFpWyW', {
            attribution: '<a href="https://www.maptiler.com/copyright/" target="_blank">&copy; MapTiler</a> <a href="https://www.openstreetmap.org/copyright" target="_blank">&copy; OpenStreetMap contributors</a>'
        });

        var baseMaps = {
            'Standard': osm,
            'Satellite': satellite,
            'Street': streets,
            'Outdoor': outdoor,
            'Topography': topo
        }
        var layerControl1 = L.control.layers(baseMaps).addTo(map);


        //geoJSON file with all passes
        var geoJSONArray = [];
        var selected = [];
        var id;

        var markers = L.markerClusterGroup({
            spiderfyOnMaxZoom: true,
            showCoverageOnHover: false,
            zoomToBoundsOnClick: true
        });
        

        var currentOpenMarkerID = null
        var marker = L.geoJSON(passi, {
            onEachFeature: function(feature, layer){
                var popupContent = "<div><input type='checkbox' id='colorCheckbox' /> Show routes </div>";
                layer.bindPopup('<p style="line-height: 1; margin-bottom: 5px;"><a href="' + feature.properties.link + '" target="_blank">' + feature.properties.name + '</a></div><div style="background-color: lightgray; padding: 1px;">' + feature.properties.type + '<span style="float: right;">' + feature.properties.height + ' m</span></div><div style="margin-top: 1px;">' + popupContent + '</div>');
                layer.on('mouseover', function (e) {
                    id = feature.properties.id
                    geoJSONArray[id].setStyle({ color: 'red' });
                });
                layer.on('mouseout', function (e) {
                    if (selected[id]) {
                        geoJSONArray[id].setStyle({ color: 'red' }); // Change color
                    } else {
                        geoJSONArray[id].setStyle({ color: 'purple' }); // Restore the old color
                    }
                });
                layer.on('click', function (e) {
                    this.openPopup;
                    id = feature.properties.id
                
                    // Add a listener for the checkbox change event
                    document.getElementById('colorCheckbox').addEventListener('change', function (event) {
                        selected[id] = event.target.checked;
                        updateGeoJSONLayerColor();
                    });
                }); 
                
            }});

        //cluster representation
        markers.addLayer(marker);
        map.addLayer(markers);

        
        //add js files of all tracks here with id
        var gValcava = L.geoJSON(Valcava, {
            style: function (feature) {
                return { color: 'purple' };
            },
            onEachFeature: function(feature, layer){
                layer.bindPopup(function (layer) {
                    return '<p style="margin-bottom: 5px;"><a href="' + feature.properties.link + '" target="_blank">' + feature.properties.name + '</a></p> (' + feature.properties.length + ', ' + feature.properties.elevation + ')<p style="margin-top: 5px;">';
                  });
            }
        }).addTo(map)
        var idValcava = Valcava.features[0].properties.id;
        geoJSONArray[idValcava] = gValcava;

        var gIseran = L.geoJSON(Iseran, {
            style: function (feature) {
                return { color: 'purple' };
            },
            onEachFeature: function(feature, layer){
                layer.bindPopup(function (layer) {
                    return '<p style="margin-bottom: 5px;"><a href="' + feature.properties.link + '" target="_blank">' + feature.properties.name + '</a></p> (' + feature.properties.length + ', ' + feature.properties.elevation + ')<p style="margin-top: 5px;">';
                  });
            }
        }).addTo(map)
        var idIseran = Iseran.features[0].properties.id;
        geoJSONArray[idIseran] = gIseran;

        var gZambla = L.geoJSON(Zambla, {
            style: function (feature) {
                return { color: 'purple' };
            },
            onEachFeature: function(feature, layer){
                layer.bindPopup(function (layer) {
                    return '<p style="margin-bottom: 5px;"><a href="' + feature.properties.link + '" target="_blank">' + feature.properties.name + '</a></p> (' + feature.properties.length + ', ' + feature.properties.elevation + ')<p style="margin-top: 5px;">';
                  });
            }
        }).addTo(map)
        var idZambla = Zambla.features[0].properties.id;
        geoJSONArray[idZambla] = gZambla;

        var gSelvino = L.geoJSON(Selvino, {
            style: function (feature) {
                return { color: 'purple' };
            },
            onEachFeature: function(feature, layer){
                layer.bindPopup(function (layer) {
                    return '<p style="margin-bottom: 5px;"><a href="' + feature.properties.link + '" target="_blank">' + feature.properties.name + '</a></p> (' + feature.properties.length + ', ' + feature.properties.elevation + ')<p style="margin-top: 5px;">';
                  });
            }
        }).addTo(map)
        var idSelvino = Selvino.features[0].properties.id;
        geoJSONArray[idSelvino] = gSelvino;

        var gGanda = L.geoJSON(Ganda, {
            style: function (feature) {
                return { color: 'purple' };
            },
            onEachFeature: function(feature, layer){
                layer.bindPopup(function (layer) {
                    return '<p style="margin-bottom: 5px;"><a href="' + feature.properties.link + '" target="_blank">' + feature.properties.name + '</a></p> (' + feature.properties.length + ', ' + feature.properties.elevation + ')<p style="margin-top: 5px;">';
                  });
            }
        }).addTo(map)
        var idGanda = Ganda.features[0].properties.id;
        geoJSONArray[idGanda] = gGanda;

        
        //function to highlight tracks on map
        function updateGeoJSONLayerColor() {
            if (selected[id]) {
                geoJSONArray[id].setStyle({ color: 'red' }); // Change color
            } else {
                geoJSONArray[id].setStyle({ color: 'purple' }); // Restore the old color
            }
        }
       
        //marker search
        const searchControl = new L.Control.Search({
            layer: marker,
            propertyName: 'name',
            initial: false,
            casesensitive: 	false,
            zoom: 14
        });
        map.addControl(searchControl);

        //layer button with maps and tracks, add new tracks here
        var baseMap = {
            'Tracks': osm,
        }
        var overlayMaps = {
            'Passo di Valcava': gValcava,
            'Col de l\'Is√©ran': gIseran,
            'Passo di Zambla': gZambla,
            'Selvino': gSelvino,
            'Passo di Ganda': gGanda
        }
        var layerControl2 = L.control.layers(baseMap, overlayMaps).addTo(map);

    </script>
</body>
</html>